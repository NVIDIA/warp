

<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Sparse Matrices &#8212; Warp 1.11.1</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/nvidia-sphinx-theme.css?v=933278ad" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=2ce81c1f" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />



    <script src="../_static/documentation_options.js?v=c8897f99"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=fd10adb8"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'domain_modules/sparse';</script>

    <link rel="icon" href="../_static/favicon.png"/>

    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="FEM Toolkit" href="fem.html" />
    <link rel="prev" title="Profiling" href="../deep_dive/profiling.html" />


  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="1.11.1" />


  </head>

  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>


  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/nvidia-logo-horiz-rgb-blk-for-screen.svg" class="logo__image only-light" alt="Warp 1.11.1 - Home"/>
    <img src="../_static/nvidia-logo-horiz-rgb-wht-for-screen.svg" class="logo__image only-dark pst-js-only" alt="Warp 1.11.1 - Home"/>
  
  
    <p class="title logo__title">Warp 1.11.1</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/NVIDIA/warp" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/warp-lang" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-python fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        



  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/nvidia-logo-horiz-rgb-blk-for-screen.svg" class="logo__image only-light" alt="Warp 1.11.1 - Home"/>
    <img src="../_static/nvidia-logo-horiz-rgb-wht-for-screen.svg" class="logo__image only-dark pst-js-only" alt="Warp 1.11.1 - Home"/>
  
  
    <p class="title logo__title">Warp 1.11.1</p>
  
</a>


  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/NVIDIA/warp" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/warp-lang" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-python fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">



<nav class="bd-docs-nav bd-links"
     aria-label="Table of Contents">
  <p class="bd-links__title" role="heading" aria-level="1">Table of Contents</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../user_guide/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/basics.html">Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/runtime.html">Runtime</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/devices.html">Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/differentiability.html">Differentiability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/generics.html">Generics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/tiles.html">Tiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/interoperability.html">Interoperability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/limitations.html">Limitations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/contribution_guide.html">Contribution Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/publications.html">Publications using Warp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/compatibility.html">Compatibility &amp; Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/changelog.html">Changelog</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Deep Dive</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../deep_dive/codegen.html">Code Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deep_dive/allocators.html">Allocators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deep_dive/concurrency.html">Concurrency</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deep_dive/profiling.html">Profiling</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Domain Modules</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Sparse Matrices</a></li>
<li class="toctree-l1"><a class="reference internal" href="fem.html">FEM Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="render.html">Rendering</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../api_reference/warp.html">warp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/warp_autograd.html">warp.autograd</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/warp_config.html">warp.config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/warp_fem.html">warp.fem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/warp_jax_experimental.html">warp.jax_experimental</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/warp_optim.html">warp.optim</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/warp_render.html">warp.render</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/warp_sparse.html">warp.sparse</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/warp_types.html">warp.types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/warp_utils.html">warp.utils</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Language Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../language_reference/builtins.html">Built-Ins</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Project Links</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://github.com/NVIDIA/warp">GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pypi.org/project/warp-lang">PyPI</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>



      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Sparse Matrices</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="sparse-matrices">
<h1>Sparse Matrices<a class="headerlink" href="#sparse-matrices" title="Link to this heading">#</a></h1>
<p>Warp includes a sparse linear algebra module <a class="reference internal" href="../api_reference/warp_sparse.html#module-warp.sparse" title="warp.sparse"><code class="xref py py-mod docutils literal notranslate"><span class="pre">warp.sparse</span></code></a> that implements common sparse matrix operations for simulation. The module provides efficient implementations of Block Sparse Row (BSR) matrices, with Compressed Sparse Row (CSR) matrices supported as a special case with 1x1 block size.</p>
<section id="working-with-sparse-matrices">
<h2>Working with Sparse Matrices<a class="headerlink" href="#working-with-sparse-matrices" title="Link to this heading">#</a></h2>
<section id="creating-sparse-matrices">
<h3>Creating Sparse Matrices<a class="headerlink" href="#creating-sparse-matrices" title="Link to this heading">#</a></h3>
<p>The most common way to create a sparse matrix is using coordinate (COO) format triplets:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">warp</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">wp</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">warp.sparse</span><span class="w"> </span><span class="kn">import</span> <span class="n">bsr_from_triplets</span>

<span class="c1"># Create a 4x4 sparse matrix with 2x2 blocks</span>
<span class="n">rows</span> <span class="o">=</span> <span class="n">wp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>  <span class="c1"># Row indices</span>
<span class="n">cols</span> <span class="o">=</span> <span class="n">wp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>  <span class="c1"># Column indices</span>
<span class="n">vals</span> <span class="o">=</span> <span class="n">wp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">...</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>    <span class="c1"># Block values</span>

<span class="c1"># Create BSR matrix</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">bsr_from_triplets</span><span class="p">(</span>
    <span class="n">rows_of_blocks</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>      <span class="c1"># Number of rows of blocks</span>
    <span class="n">cols_of_blocks</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>      <span class="c1"># Number of columns of blocks</span>
    <span class="n">rows</span><span class="o">=</span><span class="n">rows</span><span class="p">,</span>            <span class="c1"># Row indices</span>
    <span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span>         <span class="c1"># Column indices</span>
    <span class="n">values</span><span class="o">=</span><span class="n">vals</span>           <span class="c1"># Block values</span>
<span class="p">)</span>
</pre></div>
</div>
<p>You can also create special matrices:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">warp.sparse</span><span class="w"> </span><span class="kn">import</span> <span class="n">bsr_zeros</span><span class="p">,</span> <span class="n">bsr_identity</span><span class="p">,</span> <span class="n">bsr_diag</span>

<span class="c1"># Create empty matrix</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">bsr_zeros</span><span class="p">(</span><span class="n">rows_of_blocks</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">cols_of_blocks</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">block_type</span><span class="o">=</span><span class="n">wp</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="c1"># Create identity matrix</span>
<span class="n">I</span> <span class="o">=</span> <span class="n">bsr_identity</span><span class="p">(</span><span class="n">rows_of_blocks</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">block_type</span><span class="o">=</span><span class="n">wp</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="c1"># Create diagonal matrix</span>
<span class="n">D</span> <span class="o">=</span> <span class="n">bsr_diag</span><span class="p">(</span><span class="n">diag</span><span class="o">=</span><span class="n">wp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">]))</span>
</pre></div>
</div>
</section>
<section id="block-sizes">
<h3>Block Sizes<a class="headerlink" href="#block-sizes" title="Link to this heading">#</a></h3>
<p>BSR matrices support different block sizes. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1x1 blocks (CSR format)</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">bsr_zeros</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">block_type</span><span class="o">=</span><span class="n">wp</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="c1"># 3x3 blocks</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">bsr_zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">block_type</span><span class="o">=</span><span class="n">wp</span><span class="o">.</span><span class="n">mat33</span><span class="p">)</span>

<span class="c1"># Rectangular block sizes</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">bsr_zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">block_type</span><span class="o">=</span><span class="n">wp</span><span class="o">.</span><span class="n">mat23</span><span class="p">)</span>
</pre></div>
</div>
<p>The module also provides functions to convert between different block sizes and scalar types:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">warp.sparse</span><span class="w"> </span><span class="kn">import</span> <span class="n">bsr_copy</span><span class="p">,</span> <span class="n">bsr_assign</span>

<span class="c1"># Convert block size from 2x2 to 1x1 (BSR to CSR)</span>
<span class="n">A_csr</span> <span class="o">=</span> <span class="n">bsr_copy</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">block_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1"># Convert block size from 1x1 to 2x2 (CSR to BSR)</span>
<span class="n">A_bsr</span> <span class="o">=</span> <span class="n">bsr_copy</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">block_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="c1"># Convert scalar type from float32 to float64</span>
<span class="n">A_double</span> <span class="o">=</span> <span class="n">bsr_copy</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">scalar_type</span><span class="o">=</span><span class="n">wp</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

<span class="c1"># Convert both block size and scalar type</span>
<span class="n">A_new</span> <span class="o">=</span> <span class="n">bsr_copy</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">block_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">scalar_type</span><span class="o">=</span><span class="n">wp</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

<span class="c1"># In-place conversion using bsr_assign</span>
<span class="n">B</span> <span class="o">=</span> <span class="n">bsr_zeros</span><span class="p">(</span><span class="n">rows_of_blocks</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">cols_of_blocks</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">block_type</span><span class="o">=</span><span class="n">wp</span><span class="o">.</span><span class="n">mat22</span><span class="p">)</span>
<span class="n">bsr_assign</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="n">A</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="n">B</span><span class="p">)</span>  <span class="c1"># Converts A to 2x2 blocks and stores in B</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When converting block sizes, the source and destination block dimensions must be compatible:</p>
<ul class="simple">
<li><p>The new block dimensions must either be multiples or exact dividers of the original dimensions</p></li>
<li><p>The total matrix dimensions must be evenly divisible by the new block size</p></li>
</ul>
</div>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Valid conversions:</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">bsr_zeros</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">block_type</span><span class="o">=</span><span class="n">wp</span><span class="o">.</span><span class="n">mat22</span><span class="p">)</span>  <span class="c1"># 8x8 matrix with 2x2 blocks</span>
<span class="n">B</span> <span class="o">=</span> <span class="n">bsr_copy</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">block_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>       <span class="c1"># 8x8 matrix with 1x1 blocks</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">bsr_copy</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">block_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>       <span class="c1"># 8x8 matrix with 4x4 blocks</span>

<span class="c1"># Invalid conversion (will raise ValueError):</span>
<span class="n">D</span> <span class="o">=</span> <span class="n">bsr_copy</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">block_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>       <span class="c1"># 3x3 blocks don&#39;t divide 8x8 evenly</span>
</pre></div>
</div>
</section>
<section id="non-zero-block-count">
<h3>Non-Zero Block Count<a class="headerlink" href="#non-zero-block-count" title="Link to this heading">#</a></h3>
<p>The number of non-zero blocks in a BSR matrix is computed on the device and not automatically synchronized to the host to avoid performance overhead and allow graph capture.
The <a class="reference internal" href="../api_reference/_generated/warp.sparse.BsrMatrix.html#warp.sparse.BsrMatrix.nnz" title="warp.sparse.BsrMatrix.nnz"><code class="xref py py-attr docutils literal notranslate"><span class="pre">BsrMatrix.nnz</span></code></a> attribute of a BSR matrix is always an upper bound for the number of non-zero blocks,
but the actual count is stored on the device at <code class="docutils literal notranslate"><span class="pre">offsets[nrow]</span></code>.</p>
<p>To get the exact count on host, you can explicitly synchronize using <a class="reference internal" href="../api_reference/_generated/warp.sparse.BsrMatrix.html#warp.sparse.BsrMatrix.nnz_sync" title="warp.sparse.BsrMatrix.nnz_sync"><code class="xref py py-meth docutils literal notranslate"><span class="pre">BsrMatrix.nnz_sync()</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># The nnz attribute is an upper bound</span>
<span class="n">upper_bound</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">nnz</span>

<span class="c1"># Get the exact number of non-zero blocks</span>
<span class="n">exact_nnz</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">nnz_sync</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <a class="reference internal" href="../api_reference/_generated/warp.sparse.BsrMatrix.html#warp.sparse.BsrMatrix.nnz_sync" title="warp.sparse.BsrMatrix.nnz_sync"><code class="xref py py-meth docutils literal notranslate"><span class="pre">BsrMatrix.nnz_sync()</span></code></a> method ensures that any ongoing transfer
of the exact nnz number from the device offsets array to the host has completed
and updates the nnz upper bound.
This synchronization is only necessary when you need the exact count -
for most operations, the upper bound is sufficient.</p>
</div>
<p>If the number of non-zeros has been changed from outside of the <a class="reference internal" href="../api_reference/warp_sparse.html#module-warp.sparse" title="warp.sparse"><code class="xref py py-mod docutils literal notranslate"><span class="pre">warp.sparse</span></code></a> builtin functions, for instance by direct modifications to the offsets array, use the <a class="reference internal" href="../api_reference/_generated/warp.sparse.BsrMatrix.html#warp.sparse.BsrMatrix.notify_nnz_changed" title="warp.sparse.BsrMatrix.notify_nnz_changed"><code class="xref py py-meth docutils literal notranslate"><span class="pre">BsrMatrix.notify_nnz_changed()</span></code></a> method to ensure consistency.</p>
</section>
<section id="converting-back-to-coo-format">
<h3>Converting back to COO Format<a class="headerlink" href="#converting-back-to-coo-format" title="Link to this heading">#</a></h3>
<p>You can convert a BSR matrix back to coordinate (COO) format using the matrix’s properties:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get row indices from compressed format</span>
<span class="n">nnz</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">nnz_sync</span><span class="p">()</span>
<span class="n">rows</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">uncompress_rows</span><span class="p">()[:</span><span class="n">nnz</span><span class="p">]</span>  <span class="c1"># Returns array of row indices for each block</span>

<span class="c1"># Get column indices and values</span>
<span class="n">cols</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">columns</span><span class="p">[:</span><span class="n">nnz</span><span class="p">]</span>            <span class="c1"># Column indices for each block</span>
<span class="n">vals</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="n">nnz</span><span class="p">]</span>             <span class="c1"># Block values</span>

<span class="c1"># Now you have the COO format:</span>
<span class="c1"># - rows[i] is the row index of block i</span>
<span class="c1"># - cols[i] is the column index of block i</span>
<span class="c1"># - vals[i] is the value of block i</span>
</pre></div>
</div>
</section>
<section id="matrix-operations">
<h3>Matrix Operations<a class="headerlink" href="#matrix-operations" title="Link to this heading">#</a></h3>
<p>The module supports common matrix operations with overloaded operators:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Matrix addition</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span>

<span class="c1"># Matrix subtraction</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">A</span> <span class="o">-</span> <span class="n">B</span>

<span class="c1"># Scalar multiplication</span>
<span class="n">C</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">A</span>

<span class="c1"># Matrix multiplication</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">A</span> <span class="o">@</span> <span class="n">B</span>

<span class="c1"># Matrix-vector multiplication</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">A</span> <span class="o">@</span> <span class="n">x</span>

<span class="c1"># Transpose</span>
<span class="n">AT</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

<span class="c1"># In-place operations</span>
<span class="n">A</span> <span class="o">+=</span> <span class="n">B</span>
<span class="n">A</span> <span class="o">-=</span> <span class="n">B</span>
<span class="n">A</span> <span class="o">*=</span> <span class="mf">2.0</span>
<span class="n">A</span> <span class="o">@=</span> <span class="n">B</span>
</pre></div>
</div>
<p>For more control about memory allocations, you may use the underlying lower-level functions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">warp.sparse</span><span class="w"> </span><span class="kn">import</span> <span class="n">bsr_mm</span><span class="p">,</span> <span class="n">bsr_mv</span><span class="p">,</span> <span class="n">bsr_axpy</span><span class="p">,</span> <span class="n">bsr_scale</span>

<span class="c1"># Matrix-matrix multiplication</span>
<span class="c1"># C = alpha * A @ B + beta * C</span>
<span class="n">bsr_mm</span><span class="p">(</span>
    <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span>           <span class="c1"># Input and output matrices</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>         <span class="c1"># Scale factor for A @ B</span>
    <span class="n">beta</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>          <span class="c1"># Scale factor for C</span>
<span class="p">)</span>

<span class="c1"># Matrix-vector multiplication</span>
<span class="c1"># y = alpha * A @ x + beta * y</span>
<span class="n">bsr_mv</span><span class="p">(</span>
    <span class="n">A</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>           <span class="c1"># Input matrix, vector, and output vector</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>         <span class="c1"># Scale factor for A @ x</span>
    <span class="n">beta</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>          <span class="c1"># Scale factor for y</span>
<span class="p">)</span>

<span class="c1"># Matrix addition</span>
<span class="c1"># C = alpha * A + beta * B</span>
<span class="n">bsr_axpy</span><span class="p">(</span>
    <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span>           <span class="c1"># Input and output matrices</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>         <span class="c1"># Scale factor for A</span>
    <span class="n">beta</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>          <span class="c1"># Scale factor for B</span>
<span class="p">)</span>

<span class="c1"># Matrix scaling</span>
<span class="c1"># A = alpha * A</span>
<span class="n">bsr_scale</span><span class="p">(</span>
    <span class="n">A</span><span class="p">,</span>                 <span class="c1"># Input/output matrix</span>
    <span class="n">alpha</span><span class="p">,</span>             <span class="c1"># Scale factor</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="kernel-level-utilities">
<h3>Kernel-level utilities<a class="headerlink" href="#kernel-level-utilities" title="Link to this heading">#</a></h3>
<p>The following Warp functions are available for use in kernels:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../api_reference/_generated/warp.sparse.bsr_row_index.html#warp.sparse.bsr_row_index" title="warp.sparse.bsr_row_index"><code class="xref py py-func docutils literal notranslate"><span class="pre">warp.sparse.bsr_row_index()</span></code></a></p></li>
<li><p><a class="reference internal" href="../api_reference/_generated/warp.sparse.bsr_block_index.html#warp.sparse.bsr_block_index" title="warp.sparse.bsr_block_index"><code class="xref py py-func docutils literal notranslate"><span class="pre">warp.sparse.bsr_block_index()</span></code></a></p></li>
</ul>
</section>
</section>
<section id="iterative-linear-solvers">
<span id="id1"></span><h2>Iterative Linear Solvers<a class="headerlink" href="#iterative-linear-solvers" title="Link to this heading">#</a></h2>
<p>The <a class="reference internal" href="../api_reference/warp_optim_linear.html#module-warp.optim.linear" title="warp.optim.linear"><code class="xref py py-mod docutils literal notranslate"><span class="pre">warp.optim.linear</span></code></a> module provides several iterative linear solvers with optional preconditioning:</p>
<ul class="simple">
<li><p>Conjugate Gradient (CG)</p></li>
<li><p>Conjugate Residual (CR)</p></li>
<li><p>Bi-Conjugate Gradient Stabilized (BiCGSTAB)</p></li>
<li><p>Generalized Minimal Residual (GMRES)</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">warp.optim.linear</span><span class="w"> </span><span class="kn">import</span> <span class="n">cg</span>

<span class="c1"># Solve Ax = b</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">cg</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span>
</pre></div>
</div>
<p>While primarily intended for sparse matrices, these solvers also work with dense linear operators provided as 2D Warp arrays.
Custom operators can be implemented using the <a class="reference internal" href="../api_reference/_generated/warp.optim.linear.LinearOperator.html#warp.optim.linear.LinearOperator" title="warp.optim.linear.LinearOperator"><code class="xref py py-class docutils literal notranslate"><span class="pre">warp.optim.linear.LinearOperator</span></code></a> interface.</p>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../deep_dive/profiling.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Profiling</p>
      </div>
    </a>
    <a class="right-next"
       href="fem.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">FEM Toolkit</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            


              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#working-with-sparse-matrices">Working with Sparse Matrices</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-sparse-matrices">Creating Sparse Matrices</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#block-sizes">Block Sizes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#non-zero-block-count">Non-Zero Block Count</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#converting-back-to-coo-format">Converting back to COO Format</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#matrix-operations">Matrix Operations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kernel-level-utilities">Kernel-level utilities</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#iterative-linear-solvers">Iterative Linear Solvers</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  
  <div class="tocsection editthispage">
    <a href="https://github.com/NVIDIA/warp/edit/v1.11.1/docs/domain_modules/sparse.rst">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

</div></div>
              
            

          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  

  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>


  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
<a class="footer-brand logo" href="https://www.nvidia.com">
  <img src="../_static/nvidia-logo-horiz-rgb-1c-blk-for-screen.svg" class="logo__image only-light" alt="NVIDIA"/>
  <img src="../_static/nvidia-logo-horiz-rgb-1c-wht-for-screen.svg" class="logo__image only-dark" alt="NVIDIA"/>
</a></div>
      
        <div class="footer-item">




  <p class="copyright">
    
      Copyright © 2022-2026 NVIDIA Corporation.
      <br/>
    
  </p>
</div>
      
    </div>
  
  
  
</div>

  </footer>
  </body>
</html>